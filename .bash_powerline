#!/usr/bin/env bash

## Uncomment to disable git info
#POWERLINE_GIT=0

__powerline() {
    # Colorscheme
    readonly RESET='\[\033[m\]'
    readonly COLOR_CWD='\[\033[0;34m\]' # blue
    readonly COLOR_GIT='\[\033[0;36m\]' # cyan
    readonly COLOR_SUCCESS='\[\033[0;32m\]' # green
    readonly COLOR_FAILURE='\[\033[0;31m\]' # red
    readonly COLOR_YELLOW='\[\033[0;33m\]' # yellow
    readonly COLOR_MAGENTA='\[\033[0;35m\]' # magenta
    readonly COLOR_CYAN='\[\033[0;36m\]' # cyan
    readonly COLOR_WHITE='\[\033[0;37m\]' # white


    readonly SYMBOL_GIT_BRANCH='⑂'
    readonly SYMBOL_GIT_MODIFIED='*'
    readonly SYMBOL_GIT_PUSH='↑'
    readonly SYMBOL_GIT_PULL='↓'

    if [[ -z "$PS_SYMBOL" ]]; then
      case "$(uname)" in
          Darwin)   PS_SYMBOL='';;
          Linux)    PS_SYMBOL='\$';;
          *)        PS_SYMBOL='%';;
      esac
    fi


    ps1() {
        # Check the exit code of the previous command and display different
        # colors in the prompt accordingly. 
        if [ $? -eq 0 ]; then
            local symbol="$COLOR_SUCCESS $PS_SYMBOL $RESET"
        else
            local symbol="$COLOR_FAILURE $PS_SYMBOL $RESET"
        fi

        local cwd="$COLOR_MAGENTA[\w]$RESET"
        
        # add user@host
        host="${COLOR_SUCCESS}[\u@\H]${RESET}"

        # git statuses
        source ${HOME}/.dotfiles/etc/gitstatus/gitstatus.prompt.sh

        PS1="\n${host}${cwd} ${GITSTATUS_PROMPT} $(type kubectl >/dev/null 2>&1 && kube_ps1)\n[$(date '+%Y/%m/%d %H:%M:%S')]$symbol"
    }

    PROMPT_COMMAND="ps1${PROMPT_COMMAND:+; $PROMPT_COMMAND}"
}

__powerline
unset __powerline
